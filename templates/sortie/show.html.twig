{% extends 'base.html.twig' %}

{% block title %}Sortie{% endblock %}

{% block body %}
    <h1>Sortie</h1>

    <table class="table">
        <tbody>
            <tr>
                <th>Id</th>
                <td>{{ sortie.id }}</td>
            </tr>
            <tr>
                <th>Nom</th>
                <td>{{ sortie.nom }}</td>
            </tr>
            <tr>
                <th>DateHeureDebut</th>
                <td>{{ sortie.dateHeureDebut ? sortie.dateHeureDebut|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
            <tr>
                <th>Duree</th>
                <td>{{ sortie.duree }}</td>
            </tr>
            <tr>
                <th>DateLimiteInscription</th>
                <td>{{ sortie.dateLimiteInscription ? sortie.dateLimiteInscription|date('Y-m-d') : '' }}</td>
            </tr>
            <tr>
                <th>NbInscriptionMax</th>
                <td>{{ sortie.nbInscriptionMax }}</td>
            </tr>
            <tr>
                <th>InfosSortie</th>
                <td>{{ sortie.infosSortie }}</td>
            </tr>
            <tr>
                <th>Campus</th>
                <td>{{ sortie.campus.nom }}</td>
            </tr>
            <tr>
                <th>Lieu</th>
                <td>{{ sortie.lieu.nom }} ({{ sortie.lieu.rue }}, {{ sortie.lieu.ville.codePostal }} {{ sortie.lieu.ville.nom }})</td>
            </tr>
            <tr>
                <th>Organisateur</th>
                <td>{{ sortie.organisateur.prenom }} {{ sortie.organisateur.nom }}</td>
            </tr>
            <tr>
                <th>Etat</th>
                <td>{{ sortie.etat.libelle }}</td>
            </tr>
        </tbody>
    </table>

    <h2 class="mt-4">Localisation</h2>
    <div id="sortieMap" style="height: 400px; width: 100%;"></div>

    <a href="{{ path('sortie_list') }}">back to list</a>

    <a href="{{ path('sortie_edit', {'id': sortie.id}) }}">edit</a>

    {{ include('sortie/_delete_form.html.twig') }}

    <script>
        (function() {
            const lat = {{ sortie.lieu.latitude|default('null')|json_encode|raw }};
            const lon = {{ sortie.lieu.longitude|default('null')|json_encode|raw }};
            const lieuNom = {{ sortie.lieu.nom|json_encode|raw }};

            if (lat !== null && lon !== null) {
                const map = L.map('sortieMap').setView([lat, lon], 13);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);

                L.marker([lat, lon]).addTo(map)
                    .bindPopup(lieuNom)
                    .openPopup();
            } else {
                document.getElementById('sortieMap').innerHTML = '<div class="alert alert-warning">Coordonn√©es GPS non disponibles pour ce lieu.</div>';
            }
        })();
    </script>
{% endblock %}
