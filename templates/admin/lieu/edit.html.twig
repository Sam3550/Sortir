{% extends 'base.html.twig' %}

{% block title %}Édition d'un Lieu{% endblock %}

{% block body %}
    <h1>Édition d'un Lieu</h1>

    {{ include('admin/lieu/_form.html.twig', {'button_label': 'Update'}) }}

    <h2 class="mt-4">Aperçu</h2>
    <div id="map" style="height: 400px; width: 100%;"></div>

    <a href="{{ path('app_lieu_index') }}" class="btn btn-secondary mt-3">Retour à la liste</a>

    {{ include('admin/lieu/_delete_form.html.twig') }}

    <script>
        // We can safely assume L is available because it's loaded in base.html.twig's head
        (function() {
            const lat = {{ lieu.latitude|default('null')|json_encode|raw }};
            const lon = {{ lieu.longitude|default('null')|json_encode|raw }};

            if (lat !== null && lon !== null) {
                const map = L.map('map').setView([lat, lon], 13);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);

                L.marker([lat, lon]).addTo(map)
                    .bindPopup({{ lieu.nom|json_encode|raw }})
                    .openPopup();
            } else {
                document.getElementById('map').innerHTML = '<div class="alert alert-warning">Coordonnées GPS non disponibles pour ce lieu.</div>';
            }
        })();
    </script>
{% endblock %}
